```sql
SELECT *
FROM PAY_MERCHANT_ORDER
WHERE OUT_TRADE_NO='TCC20011714224700182176';
```

Short1~4
Integer5~9
Long10~18
BigDecimal18以上

网关相关

PAY_SYS_PROFILE
PAY_BANK PB "定义银行编码及第三方支付编码(比如微信扫码)"
PAY_TYPE PT "支付类型"
PAY_BANK_TYPE PBT "银行提供的支付产品以及支付类型"
PAY_GATE PG "支付网关"
PAY_GATE_BANKS PGB "网关可使用的银行"
PAY_USER_GATE_BANK PUGB "商户网关银行配置"
PAY_USER_GATE_CONF PUGC "商户网关配置表"
PAY_CUSTOM_TYPE PCT

模型关系

PB.bank_type = PBT.bank_type
PBT.pay_type_id = pt.pay_type_id
PB.bank_code = PGB.bank_code
PB.bank_code = PUGB.bank_code
PG.gate_code = PGB.gate_code
PG.gate_code = PUGB.gate_code
PG.gate_code = PUGC.gate_code
PUGB.acct_id = PUGC.acct_id
PUGB.Acct_Id = pct.acct_id

```sql
-- 新增银行 0851
INSERT INTO PAY_BANK (BANK_CODE, BANK_NAME, BANK_REMARK, BANK_TYPE, BANK_DESC,BANK_ICON, BANK_SWITCH)
VALUES ('0851', '微信支付(小程序)', '微信支付(小程序)', 8, '微信安全支付','weixin',1)

-- 新增网关 WX0008
INSERT INTO PAY_GATE (GATE_CODE, GATE_NAME, GATE_SWITCH, CUSTOM_PAY, IS_LAZY_FLG, ORIGINAL_REFUND_FLAG)
VALUES ('LKLLED000134','拉卡拉分账', 1, 1, 0, 0);

-- 新增网关-银行对应关系
INSERT INTO PAY_GATE_BANKS (GATE_BANK_ID, GATE_CODE, BANK_CODE, GATE_BANK_SWITCH)
VALUES (SEQ_GATE_BANK_ID.nextval, 'LKLLED000134', '', 1);

-- 新增费率配置
INSERT INTO PAY_RATE_CONF (RATE_CONF_ID, RATE, MIN_PAY_AMOUNT, MAX_PAY_AMOUNT, MIN_SINGLE_RATE, MAX_SINGLE_RATE, FREE_LIMIT_AMOUNT, RATE_TYPE)
VALUES (SEQ_PAY_RATE_CONF_ID.nextval, 6, 0, 0, 0, 0, 0, 1);

-- 新增用户-网关-银行对应关系
INSERT INTO PAY_USER_GATE_BANK (USER_GATE_BANK_ID, ACCT_ID, BANK_CODE, GATE_CODE, RATE_CONF_ID, BANK_GATE_SWITCH)
VALUES (SEQ_PAY_USER_GATE_BANK_ID.nextval, (select psp.USER_ID from PAY_SYS_PROFILE psp where psp.SYSTEM_ID=101), '', 'LKLLED000134', (SELECT max(RATE_CONF_ID) FROM PAY_RATE_CONF where RATE=6), 1);

-- 新增账号秘钥配置
INSERT INTO PAY_USER_GATE_KEY (USER_GATE_KEY_ID, GATE_CODE, ACCOUNT_NO,ACCOUNT,PAY_KEY,QUERY_KEY,PAY_PRIVATE_KEY,STATE)
VALUES (SEQ_PAY_USER_GATE_KEY_ID.nextval, 'LKLLED000134','','','','','/home/tomcat/tomcat/conf/ofcert/zdywx/6d25d1fd952033b4a5b1667842b9244e.p12',1);

-- 新建用户网关配置
INSERT INTO PAY_USER_GATE_CONF (USER_GATE_CONF_ID, GATE_CODE, ACCT_ID, USER_GATE_KEY_ID, RATE_CONF_ID, GATE_SWITCH, AUDIT_STATE)
VALUES (SEQ_PAY_USER_GATE_CONF_ID.nextval, 'LKLLED000134', (select psp.USER_ID from PAY_SYS_PROFILE psp where psp.SYSTEM_ID=101), (SELECT USER_GATE_KEY_ID FROM PAY_USER_GATE_KEY WHERE GATE_CODE = 'LKLLED000134' AND ACCOUNT = ''), (SELECT max(RATE_CONF_ID) FROM PAY_RATE_CONF where RATE=6), 1, 1);  
```

# 交易相关

## 支付单相关

PAY_TRADE_ORDER 交易订单记录
PAY_TRADE_ORDER_EXT 交易记录订单扩展
PAY_TRADE_MULTI 
PAY_PROFIT 交易分润记录
PAY_TRADE_SPLIT 拆分支付订单，一笔交易订单拆为多种支付方式

ACCT_USER 用户基础信息
ACCT_USER_EXTERNAL 用户外部信息
ACCT_USER_INFO 冗余的会员信息

ACCT_BALANCE 账户余额
ACCT_TALLY_BALANCE 账务记账业务余额

```sql
-- 查询自定义 bank
SELECT pugb.user_gate_bank_id,
       pugb.acct_id,
       pugb.bank_code,
       pb.bank_name,
       pb.bank_icon,
       pb.bank_desc,
       pugb.gate_code,
       pg.gate_name,
       pgb.p2b_type,
       pg.is_lazy_flg,
       pugb.rate_conf_id,
       pb.bank_type,
       pbt.type_name,
       pbt.pay_type_id,
       pt.pay_type_name,
       prc.rate_type,
       prc.rate,
       prc.min_single_rate,
       prc.max_single_rate,
       prc.min_pay_amount,
       prc.max_pay_amount,
       prc.free_limit_amount
FROM pay_user_gate_bank pugb
         LEFT JOIN pay_gate_banks pgb
                   ON pgb.bank_code = pugb.bank_code
                       AND pgb.gate_code = pugb.gate_code
         LEFT JOIN pay_gate pg
                   ON pg.gate_code = pugb.gate_code
         LEFT JOIN pay_bank pb
                   ON pb.bank_code = pgb.bank_code
         LEFT JOIN pay_bank_type pbt
                   ON pbt.bank_type = pb.bank_type
         LEFT JOIN pay_type pt
                   ON pbt.pay_type_id = pt.pay_type_id
         LEFT JOIN pay_user_gate_conf pugc
                   ON pugc.acct_id = pugb.acct_id
                       AND pugc.gate_code = pugb.gate_code
         LEFT JOIN pay_rate_conf prc
                   ON (CASE
                           WHEN pugb.rate_conf_id IS NULL THEN
                               PUGC.RATE_CONF_ID
                           ELSE
                               PUGB.RATE_CONF_ID
                       END) = prc.rate_conf_id
WHERE pugb.acct_id = ''
  AND pugb.bank_gate_switch = 1
  AND pgb.gate_bank_switch = 1
  AND pg.gate_switch = 1
  AND pugc.gate_switch = 1
  AND pugc.audit_state = 1
  AND pbt.type_switch = 1
  AND pb.bank_switch = 1
  AND PUGB.GATE_CODE != 'ZDYPAYFLAG'
  AND PUGB.ACCT_ID NOT IN
      (SELECT DISTINCT USER_ID FROM PAY_SYS_PROFILE WHERE STATE = 1)
ORDER BY PB.PRIORITY DESC, PB.BANK_TYPE, PB.BANK_CODE;
      
 -- 查询所拥有的 bank
 SELECT pugb.user_gate_bank_id,
       pugb.acct_id,
       pugb.bank_code,
       pb.bank_name,
       pb.bank_icon,
       pb.bank_desc,
       pugb.gate_code,
       pg.gate_name,
       pgb.p2b_type,
       pg.is_lazy_flg,
       pugb.rate_conf_id,
       pb.bank_type,
       pbt.type_name,
       pbt.pay_type_id,
       pt.pay_type_name,
       prc.rate_type,
       prc.rate,
       prc.min_single_rate,
       prc.max_single_rate,
       prc.min_pay_amount,
       prc.max_pay_amount,
       prc.free_limit_amount
FROM pay_user_gate_bank pugb
         LEFT JOIN pay_gate_banks pgb
                   ON pgb.bank_code = pugb.bank_code
                       AND pgb.gate_code = pugb.gate_code
         LEFT JOIN pay_gate pg
                   ON pg.gate_code = pugb.gate_code
         LEFT JOIN pay_bank pb
                   ON pb.bank_code = pgb.bank_code
         LEFT JOIN pay_bank_type pbt
                   ON pbt.bank_type = pb.bank_type
         LEFT JOIN pay_type pt
                   ON pbt.pay_type_id = pt.pay_type_id
         LEFT JOIN pay_user_gate_conf pugc
                   ON pugc.acct_id = pugb.acct_id
                       AND pugc.gate_code = pugb.gate_code
         LEFT JOIN pay_rate_conf prc
                   ON (CASE
                           WHEN pugb.rate_conf_id IS NULL THEN
                               PUGC.RATE_CONF_ID
                           ELSE
                               PUGB.RATE_CONF_ID
                       END) = prc.rate_conf_id
WHERE pugb.acct_id = ''
  AND pugb.bank_gate_switch = 1
  AND pgb.gate_bank_switch = 1
  AND pg.gate_switch = 1
  AND pugc.gate_switch = 1
  AND pugc.audit_state = 1
  AND pbt.type_switch = 1
  AND pb.bank_switch = 1
  AND PUGB.ACCT_ID IN
      (SELECT DISTINCT USER_ID FROM PAY_SYS_PROFILE WHERE STATE = 1)
ORDER BY PB.PRIORITY DESC, PB.BANK_TYPE, PB.BANK_CODE;
```

## 银行相关

```sql
INSERT INTO PAY_BANK(BANK_CODE, BANK_NAME, BANK_REMARK, BANK_TYPE, BANK_DESC, BANK_ICON, BANK_SWITCH, PRIORITY)
VALUES ('0191', '广东农村商业银行', '广东农村商业银行', 1, '广东农村商业银行', 'bjrcb', 1, 0);

INSERT INTO PAY_BANK_UNIT(BANK_CODE, BANK_NAME, BANK_ICON)
VALUES ('0191', '广东农村商业银行', 'bjrcb');

INSERT INTO PAY_UNITEBANK_INFO(UNIT_CODE, UNIT_NAME, PROV_CODE, DESCRIPT, BANK_CODE, BANK_NAME, ACTIVE_STATE)
VALUES ('314588000065', '佛山顺德农村商业银行股份有限公司北窖支行', '528311', '广东省佛山市顺德区北窖镇蓬莱一路22号', '0191', '广东农村商业银行', 1);
```

