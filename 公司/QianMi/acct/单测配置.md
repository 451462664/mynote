>gateway

需要在 com.qianmi.acct.gateway.TestApplication 中增加 @ActiveProfiles("test0")
需要在 core pom.xml 中增加，这样 mybatis xml 才可以编译

```xml
<!-- build 标签下 -->
<resources>
    <resource>
        <directory>src/main/java</directory>
        <includes>
            <include>**/*.properties</include>
            <include>**/*.xml</include>
        </includes>
        <filtering>false</filtering>
    </resource>
    <resource>
        <directory>src/main/resources</directory>
        <includes>
            <include>**/*.properties</include>
            <include>**/*.xml</include>
        </includes>
        <filtering>true</filtering>
    </resource>
</resources>
```

> query

application.properties

```prope
## 本配置文件适用于本机开发环境
spring.profiles.active=test0
####应用信息
info.app.name=acct-micro-acctbook-query
info.app.description=acct micro acctbook query service
info.build.artifact=@project.artifactId@
info.build.version=@project.version@
spring.application.name=${info.app.name}
####API文档配置
qianmi.api-doc.title=${info.app.name} Api Documentation -v ${info.build.version}
qianmi.api-doc.description=${info.app.description}
qianmi.api-doc.license=Apache 2.0
qianmi.api-doc.license-url=http://www.apache.org/licenses/LICENSE-2.0.html
qianmi.api-doc.term-of-service-url=http://www.qianmi.com
####Server配置
server.port=8080
server.tomcat.max-threads=200
server.session.timeout=30
server.session.cookie.http-only=true
server.session.cookie.secure=true
server.session.cookie.max-age=604800
server.session.tracking-modes=COOKIE
server.error.path=/error
server.error.whitelabel.enabled=false
server.error.include-stacktrace=ALWAYS
####安全配置
####Actuator管理端配置
#management.port=9001
#endpoints.jolokia.enabled=false
#endpoints.shutdown.enabled=true
# 磁盘空间检测(小于1000m告警)
management.health.diskspace.enabled=true
management.health.diskspace.path=/
management.health.diskspace.threshold=1048576000
# 不启用千米微服务自带的JwtInterceptor
jwt.secret-key=false
####是否开启优雅停机
qianmi.health.enable-graceful=true
# 请求流控
# 自定义服务器请求流控
qianmi.acct.acctbook.query.api.traffic.server.enabled=true
qianmi.acct.acctbook.query.api.traffic.server.max-requests-per-server-per-minute=100000

####日志配置
# 日志级别
logging.level.root=INFO
logging.level.requestLog=INFO
logging.level.com.zaxxer.hikari=WARN
logging.level.com.alibaba.dubbo=WARN
logging.level.org.springframework=INFO
logging.level.springfox.documentation=WARN
logging.level.com.qianmi.acct.acctbook.query.api.DubboApiAop=INFO
logging.level.org.springframework.jms.listener.DefaultMessageListenerContainer=OFF
# HTTP消息日志(请求和应答)
request.log.enable=false
# 是否记录请求参数；默认：true;
request.log.needParam=true
# 是否记录响应结果；默认：false;
request.log.needResult=true
# 过滤器加载顺序，数字越小优先级越高，可以是负数；
request.log.order=0
# 不希望记录日志的Method, 如果有多个可以采用英文半角逗号(",")分隔
request.log.exclude-methods=OPTIONS,HEAD
# 不希望记录日志的URL Pattern, 如果有多个可以采用英文半角逗号(",")分隔
request.log.exclude-patterns=/_jiankong.jsp,/,/robots.txt,/favicon.ico
# 最大返回结果长度，超过此长度记录时会被截取
#request.log.maxResultLength=512
# 最大请求参数体长度，超过此长度记录时会被截取
#request.log.maxBodyLength=512
# 过滤器路径, 多个可以使用","分隔
#request.log.urlPatterns=/*
# Service和Repository方法日志
qianmi.log.aspect.enable=false
# D编号字段名
request.log.site-owner-key=adminId


#### ActiveMQ
# MQ控制台地址：
#开发环境：http://172.19.65.38:8161/，登录账号：admin／admin
#spring.activemq.broker-url=tcp://172.19.65.38:61616
#测试1环境：http://172.21.4.29:8161/，登录账号：admin／admin
spring.activemq.broker-url=tcp://172.21.4.29:61616
#测试4环境：http://172.19.68.15:8161/，登录账号：admin／admin
#spring.activemq.broker-url=tcp://172.19.68.15:61616
#性能环境
#spring.activemq.broker-url=tcp://172.21.4.78:61616
#本机环境
#spring.activemq.broker-url=tcp://127.0.0.1:61616
spring.activemq.pool.enabled=true
spring.activemq.pool.maxConnections=10

#### Dubbo配置
qianmi.dubbo.annotation.scan-package=com.qianmi.acct.acctbook.query
qianmi.dubbo.application.logger=slf4j
qianmi.dubbo.application.name=${info.app.name}
# develop/test/product
qianmi.dubbo.application.environment=develop
qianmi.dubbo.application.owner=acct-micro-acctbook-query
qianmi.dubbo.application.version=1.0.0
## dubbo注册中心
#开发环境，对应的控制台：http://172.19.65.13:8080/，登录账号：root/master123
#qianmi.dubbo.registry.address=172.19.65.33:2181
#测试1环境，对应的控制台：http://172.19.66.25:8080/，登录账号：root/master123
qianmi.dubbo.registry.address=172.19.66.49:2181
#测试4环境，对应的控制台：http://172.19.68.8:8080/，登录账号：root/master123
#qianmi.dubbo.registry.address=172.19.68.3:2181
#性能环境
#qianmi.dubbo.registry.address=172.21.4.71:2181
qianmi.dubbo.registry.protocol=zookeeper
qianmi.dubbo.registry.timeout=10000
qianmi.dubbo.registry.file=./.dubbo/${info.app.name}.cache
#默认不注册，线上需放开
qianmi.dubbo.registry.register=true
## dubbo protocol
# dubbo
qianmi.dubbo.primary-protocol.name=dubbo
qianmi.dubbo.primary-protocol.port=20880
# jsonrpc
qianmi.dubbo.secondary-protocol.name=jsonrpc
qianmi.dubbo.secondary-protocol.port=8080
qianmi.dubbo.secondary-protocol.server=servlet
qianmi.dubbo.secondary-protocol.is-default=false
## dubbo provider
qianmi.dubbo.provider.enable=true
qianmi.dubbo.provider.filter=providerlogfilter
qianmi.dubbo.provider.timeout=10000
qianmi.dubbo.provider.delay=-1
qianmi.dubbo.provider.retries=0
qianmi.dubbo.provider.token=false
## dubbo consumer
dubbo.uc.version=1.0
qianmi.dubbo.consumer.enable=true
qianmi.dubbo.consumer.check=false
qianmi.dubbo.consumer.timeout=10000
qianmi.dubbo.consumer.retries=0
qianmi.dubbo.consumer.lazy=true
qianmi.dubbo.consumer.filter=consumerlogfilter

####JSON序列化
spring.jackson.default-property-inclusion=NON_NULL

#### 异步执行器
async.corePoolSize=20
async.maxPoolSize=150
async.queueCapacity=10000
async.threadNamePrefix=acct-acctbook-query-async-executor-

#### Redis配置
spring.redis.database=0
spring.redis.host=172.19.68.138
#spring.redis.host=127.0.0.1
spring.redis.timeout=2000
spring.redis.pool.max-wait=1000
spring.redis.pool.max-active=200
spring.redis.pool.max-idle=200
spring.redis.pool.min-idle=2

####数据源配置
#spring.datasource.driver-class-name=com.mysql.jdbc.Driver
#spring.datasource.url=jdbc:mysql://127.0.0.1:3306/d2ctcmysql?useUnicode=true&characterEncoding=UTF-8&allowMultiQueries=true&autoReconnect=true&useSSL=false

spring.datasource.driver-class-name=oracle.jdbc.driver.OracleDriver
#开发环境
#spring.datasource.url=jdbc:oracle:thin:@172.21.4.253:1521:ofpay
#spring.datasource.username=ofpayuser
#spring.datasource.password=ofcard
#测试1环境
spring.datasource.url=jdbc:oracle:thin:@172.21.4.252:1521:ofpay
spring.datasource.username=ofpayuser
spring.datasource.password=qazwsx
#测试2环境
#spring.datasource.url=jdbc:oracle:thin:@172.21.3.200:6688:qmtest
#spring.datasource.username=ofpayuser
#spring.datasource.password=zxasqw
#测试4环境
#spring.datasource.url=jdbc:oracle:thin:@172.21.4.200:6688:qmtest
#spring.datasource.username=ofpayuser
#spring.datasource.password=ofcard
spring.datasource.connection-timeout=10000
spring.datasource.idle-timeout=60000
spring.datasource.max-lifetime=180000
spring.datasource.minimum-idle=2
spring.datasource.maximum-pool-size=10
spring.datasource.tomcat.initSQL=select 1 from dual

###mybatis##
mybatis.mapperLocations=classpath*:META-INF/mapping/acctbook/query/*.xml,META-INF/mapping/payment/*.xml,META-INF/mapping/gateway/*.xml
mybatis.typeAliasesPackage=com.qianmi.acct.acctbook.query.entity
logging.level.com.qianmi.acct.gateway.repository.mapper=debug

#### Hystrix
## https://github.com/Netflix/Hystrix/wiki/Configuration#intro

# Should Hystrix interrupt a command that is overdue?
# default: true
hystrix.command.default.execution.isolation.thread.interruptOnTimeout=true

# How many errors are allowed before the circuit breaker is activated?
# default: 50 (must be greater than 0,
# 100 means no breaking despite of errors)
hystrix.command.default.circuitBreaker.errorThresholdPercentage=50

# How many requests are needed in the time span to trigger the circuit breaker?
# default: 20
hystrix.command.default.circuitBreaker.requestVolumeThreshold=20

# After what time (in ms) should the circuit breaker try a single request?
# default: 5000
hystrix.command.default.circuitBreaker.sleepWindowInMilliseconds=5000

# default: 1000 = 1 second; command execution timeout
hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=10000

# default: 10; Number of concurrent requests permitted to HystrixCommand#getFallback(). Requests beyond the concurrent limit will fail-fast and not attempt retrieving a fallback.
hystrix.command.default.fallback.isolation.semaphore.maxConcurrentRequests=10

# default: 10; set corePoolSize and maxPoolSize to the same value
hystrix.threadpool.default.coreSize=2

# default: -1 SynchronousQueue; positive value for LinkedBlockingQueue
hystrix.threadpool.default.maxQueueSize=5000

# default: 5; not applicable if maxQueueSize == -1; an artificial maximum queue size at which rejections will occur even if maxQueueSize has not been reached
hystrix.threadpool.default.queueSizeRejectionThreshold=5000

# default: 1; keep-alive time in minutes; in practice not used since the corePoolSize and maxPoolSize are set to the same value in the default implementation
# This is in practice not used since the corePoolSize and maxPoolSize are set to the same value in the default implementation, but if you were to use a custom implementation via plugin then this would be available for you to use.
hystrix.threadpool.default.keepAliveTimeMinutes=1

scheduled.payment.finRecon.cron=0 0/10 * * * ?
```

