# 卡友

```sql
ALTER TABLE `smart_team`.`u_team` ADD COLUMN `third_id` BIGINT(20) DEFAULT 0 NOT NULL; 

DROP TABLE IF EXISTS `infra_api_log`;
CREATE TABLE `infra_api_log`
(
    `id`               BIGINT        NOT NULL AUTO_INCREMENT COMMENT '日志主键',
    `user_id`          BIGINT        NOT NULL DEFAULT '0' COMMENT '用户编号',
    `user_type`        TINYINT       NOT NULL DEFAULT '0' COMMENT '用户类型',
    `application_name` VARCHAR(50)   NOT NULL COMMENT '应用名',
    `request_method`   VARCHAR(16)   NOT NULL DEFAULT '' COMMENT '请求方法名',
    `request_url`      VARCHAR(255)  NOT NULL DEFAULT '' COMMENT '请求地址',
    `request_params`   VARCHAR(8000) NOT NULL DEFAULT '' COMMENT '请求参数',
    `user_ip`          VARCHAR(50)   NOT NULL COMMENT '用户 IP',
    `begin_time`       TIMESTAMP     NOT NULL COMMENT '开始请求时间',
    `end_time`         TIMESTAMP     NOT NULL COMMENT '结束请求时间',
    `duration`         INT           NOT NULL COMMENT '执行时长',
    `result_code`      INT           NOT NULL DEFAULT '0' COMMENT '结果码',
    `result_msg`       VARCHAR(512)           DEFAULT '' COMMENT '结果提示',
    `create_time`      TIMESTAMP     NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time`      TIMESTAMP     NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted`          BIT(1)        NOT NULL DEFAULT b'0' COMMENT '是否删除',
    PRIMARY KEY (`id`)
) ENGINE = InnoDB COMMENT ='API 访问日志表';

CREATE INDEX infra_api_log_create_time_index
    ON infra_api_log (create_time);

DROP TABLE IF EXISTS `infra_api_error_log`;
CREATE TABLE `infra_api_error_log` (
  `id` int NOT NULL AUTO_INCREMENT COMMENT '编号',
  `user_id` int NOT NULL DEFAULT '0' COMMENT '用户编号',
  `user_type` tinyint NOT NULL DEFAULT '0' COMMENT '用户类型',
  `application_name` varchar(50) NOT NULL COMMENT '应用名\n     *\n     * 目前读取 spring.application.name',
  `request_method` varchar(16) NOT NULL COMMENT '请求方法名',
  `request_url` varchar(255) NOT NULL COMMENT '请求地址',
  `request_params` varchar(8000) NOT NULL COMMENT '请求参数',
  `user_ip` varchar(50)  NOT NULL COMMENT '用户 IP',
  `exception_time` timestamp NOT NULL COMMENT '异常发生时间',
  `exception_name` varchar(128)  NOT NULL DEFAULT '' COMMENT '异常名\n     *\n     * {@link Throwable#getClass()} 的类全名',
  `exception_message` text  NOT NULL COMMENT '异常导致的消息\n     *\n     * {@link cn.iocoder.common.framework.util.ExceptionUtil#getMessage(Throwable)}',
  `exception_root_cause_message` text NOT NULL COMMENT '异常导致的根消息\n     *\n     * {@link cn.iocoder.common.framework.util.ExceptionUtil#getRootCauseMessage(Throwable)}',
  `exception_stack_trace` text NOT NULL COMMENT '异常的栈轨迹\n     *\n     * {@link cn.iocoder.common.framework.util.ExceptionUtil#getServiceException(Exception)}',
  `exception_class_name` varchar(512) NOT NULL COMMENT '异常发生的类全名\n     *\n     * {@link StackTraceElement#getClassName()}',
  `exception_file_name` varchar(512) NOT NULL COMMENT '异常发生的类文件\n     *\n     * {@link StackTraceElement#getFileName()}',
  `exception_method_name` varchar(512) NOT NULL COMMENT '异常发生的方法名\n     *\n     * {@link StackTraceElement#getMethodName()}',
  `exception_line_number` int NOT NULL COMMENT '异常发生的方法所在行\n     *\n     * {@link StackTraceElement#getLineNumber()}',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB COMMENT='系统异常日志';

CREATE INDEX infra_api_error_log_create_time_index
    ON infra_api_error_log (create_time);
```