# k8s 概念和架构

## k8s 概述和特征

### 概述

kubernetes 简称 k8s，是一个开源的，用于管理云平台中多个主机的容器化的应用，Kubernetes 的目标是让部署容器化的应用简单并且高效，k8s 提供了应用部署、规划、更新和维护的一种机制。

1. k8s 是谷歌在 2014 年开源的容器化集群管理系统
2. 使用 k8s 进行容器化应用部署
3. 使用 k8s 利于应用扩展
4. k8s 目标实施让部署容器化应用更加简洁和高效

### 特性

- 自动装箱
    - 基于容器对应用运行环境的资源配置要求自动部署应用容器
- 自动修复
    - 当容器失败时，会对容器进行重启，当所部署的 node 节点有问题时，会对容器进行重新部署和重新调度。当容器未通过监控检查时，会关闭此容器直到容器正常运行时，才会对外提供服务。
- 水平扩展
    - 通过简单的命令、用户 UI 界面或基于 CPU 等资源使用情况，对应用容器进行规模扩大或规模剪裁。
- 服务发现
    - 用户不需要使用额外的服务发现机制，就能够基于 Kubernetes 自身能力实现服务发现和负载均衡。
- 滚动更新
    - 可以根据应用的变化，对应用容器运行的应用，进行一次性或批量式更新。
- 版本回退
    - 可以根据应用部署情况，对应用运行的应用，进行历史版本即使回退。
- 密钥和配置管理
    - 在不需要重新构建镜像的情况下，可以部署和更新密钥和应用配置，类似热部署。
- 存储编排
    - 自动实现存储系统挂载及应用，特别对有状态应用实现数据持久化非常重要存储系统可以来自于本地目录、网络存储(NFS、Gluster、Ceph等)、公共云存储服务。
- 批处理
    - 提供一次性任务，定时任务: 满足批量数据处理和分析的场景。

## k8s 架构组件

master node 主控节点和 node(工作节点)

### master node 组件

#### api server

集群统一入口，以 restful 方式交给 etcd 存储。

#### scheduler

节点调度，选择 node 节点应用部署。

#### controller manager

处理集群中常规后台任务，一个资源对应一个控制器。

#### etcd

存储系统，用于保存集群数据。

### node 组件

#### kubelet

master 派到 note 节点代表，管理本机容器。

#### kube-proxy

提供网络代理，负载均衡等操作。

## k8s 核心概念

### pod

最小部署单元。
一组容器的集合。
共享网络。
生命周期是短暂的。

### controller

确保预期的 pod 副本数量。
无状态的应用部署。
有状态的应用部署。
确保所有的 node 运行同一个 pod。
一次性任务和定时任务。

### service

定义一组 pod 的访问规则。